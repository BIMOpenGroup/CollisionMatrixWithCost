## Цели
- Удалить текущий редактор сценариев и JSON‑textarea.
- Показать только верхнеуровневые сценарии; каждый раскрывается списком работ.
- Ввод данных по работам — прямо в ячейках строки (кол‑во), без редактирования самих работ.
- Добавление работ в сценарий по кнопке «+» с выбором из выпадающего списка (из предложений ячейки).
- Возможность создания/удаления сценариев, редактирования названия и обоснования.

## UI (Frontend)
- В панели «Оценка коллизий» заменить блоки на:
  - Список сценариев: строка заголовка сценария с полями `Название` и `Обоснование`, кнопки: `+ Работа`, `Удалить сценарий`, `Свернуть/Развернуть`.
  - При разворачивании — таблица работ сценария:
    - Колонки: `Работа` (name), `Соответствие` (matched_name), `Ед.`, `Ед. цена`, `Кол-во` (input number), `Итого`, `Удалить`.
    - Все поля, кроме `Кол-во`, read‑only.
  - Кнопка «Сохранить» обновляет сценарии и пересчитывает min–max.
- Диалог «Добавить работу»: поиск/фильтр по `work_type` и названию; источник — `/api/cells/:row/:col/suggestions`.
- Удалить JSON‑редактор полностью.

## Состояние и потоки данных
- `scenarios`: `Array<{ scenario: string; rationale?: string; items: Array<{ price_id?: number; name: string; matched_name?: string; unit?: string; unit_price?: number; quantity: number; total?: number; currency?: string }> }>`.
- `openScenario`: множество индексов раскрытых сценариев.
- `workOptions`: список предложений для текущей ячейки (кэш, фильтрация по `work_type`).
- При изменении количества или состава работ сценария:
  - Сразу сохранять (POST) и перечитывать расчёт, или батчить до «Сохранить» — выберем батч с явной кнопкой, чтобы избежать лишних запросов.

## API сервера (Backend)
- Расширить существующий `POST /api/cells/:rowIndex/:colIndex/collision-scenarios` для работы без JSON ручного ввода:
  - Поддержать элементы вида `{ price_id, quantity }` (при наличии `price_id` обогащать `name/unit/unit_price/currency` через `getPriceById`, игнорируя текстовый матчинг).
  - Сохранять `scenarios_json` и каждый раз пересчитывать `min/max`.
- Дополнительные вспомогательные эндпоинты для инкрементного UX (минимальный набор):
  - `POST /api/cells/:rowIndex/:colIndex/scenarios/create` → `{ scenario, rationale? }`.
  - `POST /api/cells/:rowIndex/:colIndex/scenarios/:si/meta` → `{ scenario?, rationale? }`.
  - `POST /api/cells/:rowIndex/:colIndex/scenarios/:si/items/add` → `{ price_id }`.
  - `POST /api/cells/:rowIndex/:colIndex/scenarios/:si/items/:ii/quantity` → `{ quantity }`.
  - `DELETE /api/cells/:rowIndex/:colIndex/scenarios/:si/items/:ii`.
  - `DELETE /api/cells/:rowIndex/:colIndex/scenarios/:si`.
- Все операции после изменения — пересчёт min/max и возврат актуального `collision`.
- Совместимость: если элемент приходит как `{ name }` (старый формат), применять текущий токен‑матчинг; иначе приоритетно использовать `price_id`.

## Модель данных
- `scenarios_json` хранит массив сценариев с обогащёнными полями работ; `quantity` управляется пользователем; `total = unit_price * quantity`.
- Единицы не редактируются в UI; пользователь управляет только количеством.

## Обновление расчёта min–max
- Сумма по сценарию — сумма `total` по всем работам.
- `min = min(суммы сценариев)`, `max = max(суммы сценариев)`.
- Если в сценарии нет цен — сумма 0, такие сценарии учитываются.

## Пошаговая реализация
1. Удалить JSON‑редактор и таблицу измерений сценария; добавить список сценариев с раскрывающимися работами.
2. Подключить загрузку `workOptions` из `/suggestions` для текущей ячейки; диалог выбора работы.
3. Реализовать локальную модель `scenarios` и действия: создать/удалить сценарий; добавить/удалить работу; изменить количество.
4. На «Сохранить» — отправлять весь массив `scenarios` в `POST collision-scenarios` (новый формат с `price_id/quantity`), затем перечитать `/collision-cost`.
5. (Опционально) Добавить инкрементные эндпоинты для моментальных сохранений на каждое действие.
6. Обновить рендер таблиц ниже, чтобы отображать актуальные `items` и итоги.

## Верификация
- Backend: обновить/добавить тесты для сценариев — создание, добавление работ по `price_id`, изменение количества, пересчёт min/max.
- Frontend: мануальная проверка: создание сценария → добавление нескольких работ → изменение количества → пересчёт min–max и отрисовка итого.

## Совместимость и миграция
- При чтении старых сценариев без `price_id` — оставить как есть; пользователь сможет заменить работы через «+» из предложений.
- Ссылки на внешние источники не трогаем; поведение списка предложений как раньше.

Готов приступить к реализации после подтверждения.